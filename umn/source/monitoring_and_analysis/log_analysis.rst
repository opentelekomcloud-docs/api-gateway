:original_name: apig_03_0042.html

.. _apig_03_0042:

Log Analysis
============

This section describes how to obtain and analyze the API calling logs of a **dedicated** gateway.

Prerequisites
-------------

APIs have been called.

Procedure
---------

#. Go to the APIG console.
#. Select a gateway at the top of the navigation pane.
#. In the navigation pane, choose **Monitoring & Analysis** > **Log Analysis**.

4. Click **Configure Log Collection**, and change **Collect Logs** to |image1| to enable log collection.

5. Specify a log group and log stream, and click **OK**. For details about log groups and log streams, see section "Log Management" in the *Log Tank Service User Guide*.

6. Click **Log Fields** to view the description of each log field. Then view and analyze logs by referring to the log field descriptions.

7. To export logs, see section "Log Transfer" in the *Log Tank Service User Guide*.

   Fields in access logs are separated using spaces. The following table describes each log field.

   .. table:: **Table 1** Log field description

      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | No.                   | Field                      | Description                                                                                                                                             |
      +=======================+============================+=========================================================================================================================================================+
      | 1                     | remote_addr                | Client IP address.                                                                                                                                      |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 2                     | request_id                 | Request ID.                                                                                                                                             |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 3                     | api_id                     | API ID                                                                                                                                                  |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 4                     | user_id                    | Project ID provided by a requester for IAM authentication.                                                                                              |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 5                     | app_id                     | App ID provided by a requester for app authentication.                                                                                                  |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 6                     | time_local                 | Time when a request is received.                                                                                                                        |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 7                     | request_time               | Request latency.                                                                                                                                        |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 8                     | request_method             | HTTP request method.                                                                                                                                    |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 9                     | scheme                     | Request protocol.                                                                                                                                       |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 10                    | host                       | Domain name.                                                                                                                                            |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 11                    | router_uri                 | Request URI.                                                                                                                                            |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 12                    | server_protocol            | Request protocol.                                                                                                                                       |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 13                    | status                     | Response status code.                                                                                                                                   |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 14                    | bytes_sent                 | Response size in bytes, including the status line, header, and body.                                                                                    |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 15                    | request_length             | Request length in bytes, including the start line, header, and body.                                                                                    |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 16                    | http_user_agent            | User agent ID.                                                                                                                                          |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 17                    | http_x_forwarded_for       | **X-Forwarded-For** header field.                                                                                                                       |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 18                    | upstream_addr              | Backend address.                                                                                                                                        |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 19                    | upstream_uri               | Backend URI.                                                                                                                                            |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 20                    | upstream_status            | Backend response code.                                                                                                                                  |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 21                    | upstream_connect_time      | Time taken to establish a connection with the backend.                                                                                                  |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 22                    | upstream_header_time       | Duration from the start of a connection to the first byte received from the backend.                                                                    |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 23                    | upstream_response_time     | Duration from the start of a connection to the last byte received from the backend.                                                                     |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 24                    | region_id                  | Region ID.                                                                                                                                              |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 25                    | all_upstream_response_time | Duration from the start of a connection to the last byte received from the backend, in seconds. When a retry occurs, the value is the total time taken. |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 26                    | errorType                  | API request error type. Options:                                                                                                                        |
      |                       |                            |                                                                                                                                                         |
      |                       |                            | -  **0**: non-throttling error                                                                                                                          |
      |                       |                            | -  **1**: throttling error                                                                                                                              |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 27                    | auth_type                  | API authentication mode.                                                                                                                                |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 28                    | access_model1              | Authentication mode 1.                                                                                                                                  |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 29                    | access_model2              | Authentication mode 2. Enabling two-factor authentication will use the custom authorizer ID.                                                            |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 30                    | inner_time                 | APIG internal processing duration, in seconds.                                                                                                          |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 31                    | proxy_protocol_vni         | VPC endpoint virtual network ID.                                                                                                                        |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 32                    | proxy_protocol_vpce_id     | VPC endpoint ID.                                                                                                                                        |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 33                    | proxy_protocol_addr        | Client IP address.                                                                                                                                      |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 34                    | body_bytes_sent            | API request body size, in bytes.                                                                                                                        |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 35                    | api_name                   | API name.                                                                                                                                               |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 36                    | app_name                   | Name of the app used by a requester for authentication.                                                                                                 |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 37                    | provider_app_id            | App ID of an API.                                                                                                                                       |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 38                    | provider_app_name          | App name of an API.                                                                                                                                     |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 39                    | custom_data_log1           | Custom log field 1.                                                                                                                                     |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 40                    | custom_data_log2           | Custom log field 2.                                                                                                                                     |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 41                    | custom_data_log3           | Custom log field 3.                                                                                                                                     |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 42                    | custom_data_log4           | Custom log field 4.                                                                                                                                     |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 43                    | custom_data_log5           | Custom log field 5.                                                                                                                                     |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 44                    | custom_data_log6           | Custom log field 6.                                                                                                                                     |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 45                    | custom_data_log7           | Custom log field 7.                                                                                                                                     |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 46                    | custom_data_log8           | Custom log field 8.                                                                                                                                     |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 47                    | custom_data_log9           | Custom log field 9.                                                                                                                                     |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 48                    | custom_data_log10          | Custom log field 10.                                                                                                                                    |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 49                    | response_source            | Response source. Options:                                                                                                                               |
      |                       |                            |                                                                                                                                                         |
      |                       |                            | -  **local**: APIG                                                                                                                                      |
      |                       |                            | -  **remote**: backend service                                                                                                                          |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 50                    | gzip_ratio                 | Ratio of the original response body size to the compressed response body size.                                                                          |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 51                    | upstream_scheme            | Backend protocol type.                                                                                                                                  |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 52                    | group_id                   | Group ID.                                                                                                                                               |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 53                    | apig_err_code              | Gateway error code.                                                                                                                                     |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
      | 54                    | function_urn               | Function URN.                                                                                                                                           |
      +-----------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+

.. |image1| image:: /_static/images/en-us_image_0000001225120971.png
