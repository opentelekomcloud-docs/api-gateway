:original_name: apig_03_0061.html

.. _apig_03_0061:

Kafka Log Push
==============

Kafka log push policies push calling logs of open APIs to Kafka for analysis.

.. note::

   If your gateway does not support this policy, contact technical support to upgrade the gateway to the latest version.

Usage Guidelines
----------------

-  You have understood the :ref:`guidelines for policy creation and API binding <apig_03_0019__en-us_topic_0000001221774151_en-us_topic_0000001151883501_section126118109015>`.
-  A maximum of five Kafka log push policies can be created for a gateway.
-  APIs bound with a Kafka log push policy will deteriorate in performance by 30%.

Configuration Parameters
------------------------

.. table:: **Table 1** Parameter description

   +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter                         | Description                                                                                                                                                                                                                                                                                                                                                                               |
   +===================================+===========================================================================================================================================================================================================================================================================================================================================================================================+
   | **Policy Information**            |                                                                                                                                                                                                                                                                                                                                                                                           |
   +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Broker Address                    | Connection address of the target Kafka. Separate multiple addresses with commas (,).                                                                                                                                                                                                                                                                                                      |
   +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Topic                             | Topic of the target Kafka to report logs to.                                                                                                                                                                                                                                                                                                                                              |
   +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Key                               | Partition of Kafka for storing logs as an ordered message queue. If this parameter is left blank, logs are stored in different partitions.                                                                                                                                                                                                                                                |
   +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Retry                             | Configuration for retrying when logs fail to be pushed to Kafka.                                                                                                                                                                                                                                                                                                                          |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                           |
   |                                   | -  **Retry Times**: the number of retry attempts in case of a failure. Enter 0 to 5.                                                                                                                                                                                                                                                                                                      |
   |                                   | -  **Retry Interval**: the interval of retry attempts in case of a failure. Enter 1 to 10 seconds.                                                                                                                                                                                                                                                                                        |
   +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | **SASL Configuration**            |                                                                                                                                                                                                                                                                                                                                                                                           |
   +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Security Protocol                 | Protocol used for connecting to the target Kafka.                                                                                                                                                                                                                                                                                                                                         |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                           |
   |                                   | -  **PLAINTEXT**: user authentication protocol of the default access point                                                                                                                                                                                                                                                                                                                |
   |                                   | -  **SASL_PLAINTEXT**: SASL user authentication protocol                                                                                                                                                                                                                                                                                                                                  |
   |                                   | -  **SASL_SSL**: SSL user authentication protocol                                                                                                                                                                                                                                                                                                                                         |
   +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Message Tx/Rx Mechanism           | Message transmission and receiving mechanism of the target Kafka. The default value is **PLAIN**.                                                                                                                                                                                                                                                                                         |
   +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | SASL Username                     | This parameter is available only if **Security Protocol** is set to **SASL_PLAINTEXT** or **SASL_SSL**.                                                                                                                                                                                                                                                                                   |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                           |
   |                                   | Username used for SASL or SSL authentication.                                                                                                                                                                                                                                                                                                                                             |
   +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | SASL Password                     | This parameter is available only if **Security Protocol** is set to **SASL_PLAINTEXT** or **SASL_SSL**.                                                                                                                                                                                                                                                                                   |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                           |
   |                                   | User password used for SASL or SSL authentication.                                                                                                                                                                                                                                                                                                                                        |
   +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Confirm SASL Password             | This parameter is available only if **Security Protocol** is set to **SASL_PLAINTEXT** or **SASL_SSL**.                                                                                                                                                                                                                                                                                   |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                           |
   |                                   | Enter the SASL password again.                                                                                                                                                                                                                                                                                                                                                            |
   +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Certificate Content               | This parameter is available only if **Security Protocol** is set to **SASL_SSL**.                                                                                                                                                                                                                                                                                                         |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                           |
   |                                   | CA certificate used for SSL authentication.                                                                                                                                                                                                                                                                                                                                               |
   +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | **Metadata Configuration**        |                                                                                                                                                                                                                                                                                                                                                                                           |
   +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | System Metadata                   | System fields that need to be included in pushed logs.                                                                                                                                                                                                                                                                                                                                    |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                           |
   |                                   | By default, the **start_time**, **request_id**, **client_ip**, **request_time**, **http_status**, **scheme**, **request_method**, **host**, **uri**, **upstream_addr**, **upstream_status**, **upstream_response_time**, **http_x_forwarded_for**, **http_user_agent**, and **error_type** fields are carried in logs. You can also specify other system fields that need to be included. |
   +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Request Data                      | API request information that needs to be included in pushed logs.                                                                                                                                                                                                                                                                                                                         |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                           |
   |                                   | -  **The log contains the request header**: Specify a header that needs to be included. Separate multiple headers with commas (,). The asterisk (*) can be used as a wildcard.                                                                                                                                                                                                            |
   |                                   | -  **The log contains the request QueryString**: Specify a query string that needs to be included. Separate multiple query strings with commas (,). The asterisk (*) can be used as a wildcard.                                                                                                                                                                                           |
   |                                   | -  **The log contains the request body**: If this option is selected, logs will contain the body of API requests.                                                                                                                                                                                                                                                                         |
   +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Response Data                     | API response information that needs to be included in pushed logs.                                                                                                                                                                                                                                                                                                                        |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                           |
   |                                   | -  **The log contains the response header**: Specify a header that needs to be included. Separate multiple headers with commas (,). The asterisk (*) can be used as a wildcard.                                                                                                                                                                                                           |
   |                                   | -  **The log contains the response body**: If this option is selected, logs will contain the body of API request responses.                                                                                                                                                                                                                                                               |
   +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Customized Authentication         | Custom authentication information that needs to be included in pushed logs.                                                                                                                                                                                                                                                                                                               |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                           |
   |                                   | -  **Frontend**: Enter a response field of frontend authentication that needs to be included. Separate multiple fields with commas (,).                                                                                                                                                                                                                                                   |
   |                                   | -  **Backend**: Enter a response field of backend authentication that needs to be included. Separate multiple fields with commas (,).                                                                                                                                                                                                                                                     |
   +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
